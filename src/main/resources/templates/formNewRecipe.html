<!DOCTYPE html>
<html>  <head>
    <title>Nuova ricetta</title>
    <link rel="stylesheet" href="/stile.css?version=3" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <h1>Aggiungi una ricetta</h1>
    <form th:action="@{/recipe}" method="POST" th:object="${recipe}" enctype="multipart/form-data">
<div>
        Nome: <span><input required type="text" th:field="${recipe.name}"/></span>
      </div>
      <div>
        Descrizione: <span><input required type="text" th:field="${recipe.description}"/></span>
      </div>
      <div id="images">
		Immagini ricetta: 
		<div id="image0">
			<input required type="file" name='fileImage' id="fileImage0" accept="image/png, image/jpeg" class="fileImage"/>
		</div>
      </div>
      <br>
      <div>
		  <img id="thumbnail" alt="Image Preview"/>
      </div>
        <span><button type="submit">Conferma</button></span>
      </div>
   </form>
  </body>
  <script type="text/javascript">
  var i=0;
	  function newImageInputAndThumbnail() {
		  	i++;
			addImageInput();
			showImageThumbnail(this);
			refreshEvents();
		}
		
		function removeImageInput(event) {
			//Rimuove il nodo genitore dell'elemento che ha lanciato l'evento
			event.target.parentElement.remove();
		}
	//Inizializzazione evento per l'aggiunta di ulteriori input
	$(document).ready(function() {
		$('#fileImage0').change(newImageInputAndThumbnail);
	});
	
	function showImageThumbnail(fileInput) {
		file =fileInput.files[0];
		reader = new FileReader();
		
		reader.onload = function(e) {
			$('#thumbnail').attr('src', e.target.result);
		};
		
		reader.readAsDataURL(file);
	} 
	
	function addImageInput() {
		//images.appendChild();
		var images=document.getElementById("images");
		//Creazione nuovo input e impostazione
		var newDiv=document.createElement("div");
		//Impostazione id del nuovo div contenente il nuovo input
		newDiv.id = 'image'+i.toString();
		var newInput=document.createElement("input");
		newInput.setAttribute("type", "file");
		newInput.setAttribute("name", "fileImage");
		newInput.setAttribute("accept", "image/png, image/jpeg");
		//Impostazione id del nuovo input
		newInput.setAttribute("id", 'fileImage'+i.toString());
		
		//Aggiunta elementi alla pagina
		var fileName=document.getElementById("fileImage0").cloneNode(true);
		newDiv.appendChild(fileName);
		fileName.id='fileImage'+i;
		//Pulizia selezione input clonato
		fileName.value="";
		
		images.appendChild(newDiv);
		
		if ($('#image'+(i-1)).length > 0) {
			//Aggiunta possibilit√† rimozione elemento precedente
			var newA=document.createElement("a");
			newA.setAttribute("id", 'fileImageRemove'+(i-1));
			newA.innerHTML="Rimuovi";
			document.getElementById("image"+(i-1)).appendChild(newA);
			$('#fileImageRemove'+(i-1)).click(function(event) { removeImageInput(event); });
		}		
	}
	
	function refreshEvents() {
		//Rimozione vecchio evento dall'input precedente
		$('#fileImage'+(i-1)).unbind('change');
		//Aggiunta dell'evento al nuovo elemento
		$('#fileImage'+i).change(newImageInputAndThumbnail);
	}
</script>
</html>
